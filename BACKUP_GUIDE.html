<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Backup & Restore Guide - RackPlane Documentation</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">RackPlane</h1>
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search documentation...">
                <div id="searchResults" class="search-results"></div>
            </div>
            <nav class="nav-menu" id="navMenu">
                <div class="nav-category">Getting Started</div>
<ul class="nav-items">
<li><a href="README.html" class="">RackPlane Documentation</a></li>
</ul>
<div class="nav-category">Setup & Installation</div>
<ul class="nav-items">
<li><a href="DEPLOYMENT.html" class="">Deployment Guide</a></li>
<li><a href="NETBOX_SETUP.html" class="">NetBox Integration Setup Guide</a></li>
<li><a href="LABEL_PRINTING.html" class="">Label Printing Guide</a></li>
<li><a href="QUICK_FIX.html" class="">üö® QUICK FIX: Database "dcms" Does Not Exist</a></li>
</ul>
<div class="nav-category">User Guides</div>
<ul class="nav-items">
<li><a href="STOCK_MANAGEMENT_GUIDE.html" class="">Stock Management Guide</a></li>
<li><a href="TENANT_ONBOARDING.html" class="">Tenant Onboarding Documentation</a></li>
</ul>
<div class="nav-category">Backup & Recovery</div>
<ul class="nav-items">
<li><a href="BACKUP_GUIDE.html" class="active">Database Backup & Restore Guide</a></li>
<li><a href="CROSS_SERVER_BACKUP.html" class="">Cross-Server Backup & Restore Guide</a></li>
<li><a href="EMERGENCY_RECOVERY.html" class="">üö® EMERGENCY DATABASE RECOVERY GUIDE</a></li>
</ul>
<div class="nav-category">API Reference</div>
<ul class="nav-items">
<li><a href="API_DOCUMENTATION.html" class="">API Documentation</a></li>
</ul>
            </nav>
        </aside>
        <main class="content">
            <article class="doc-content">
                <h1>Database Backup & Restore Guide</h1>

<h2>Overview</h2>

<p>The DCMS application includes comprehensive backup and restore functionality to protect your data. This guide covers all backup methods: Web UI, API, and CLI.</p>

<h2>üåê Web UI Backup</h2>

<h3>Accessing the Backup Page</h3>

<ol>
<li>Navigate to the <strong>Backup</strong> page in the navigation menu</li>
<li>View current database statistics</li>
<li>Export or import backups with a few clicks</li>
</ol>

<h3>Export Database</h3>

<ol>
<li>Click the <strong>"Download Backup"</strong> button</li>
<li>A JSON file will be downloaded with timestamp: <code>datacenter-backup-YYYY-MM-DD.json</code></li>
<li>Store this file in a safe location</li>
</ol>

<h3>Import Database</h3>

<ol>
<li>Click <strong>"Select Backup File"</strong> and choose a <code>.json</code> backup file</li>
<li>The system will automatically validate the backup</li>
<li><strong>Optional</strong>: Check "Delete all existing data" to replace the entire database (‚ö†Ô∏è DANGEROUS!)</li>
<li>Click <strong>"Import Backup"</strong></li>
<li>Review the import results</li>
</ol>

<h2>üîß CLI Backup</h2>

<h3>Export Database</h3>

<pre><code class="language-bash"># Export with auto-generated filename
cd backend
python backup_cli.py export

# Export with custom filename
python backup_cli.py export --output my_backup.json
</code></pre>

<h3>Import Database</h3>

<pre><code class="language-bash"># Import (adds to existing data)
python backup_cli.py import my_backup.json

# Import (replaces all data - WARNING!)
python backup_cli.py import my_backup.json --clear
</code></pre>

<h3>View Database Summary</h3>

<pre><code class="language-bash">python backup_cli.py summary
</code></pre>

<h2>üì° API Endpoints</h2>

<h3>Export Database</h3>
<pre><code class="language-bash">GET /api/v1/backup/export
</code></pre>

<p>Downloads complete database as JSON.</p>

<pre><code class="language-bash">curl -o backup.json http://localhost:8000/api/v1/backup/export
</code></pre>

<h3>Import Database</h3>
<pre><code class="language-bash">POST /api/v1/backup/import?clear_existing=false
Content-Type: multipart/form-data
</code></pre>

<p>Upload a backup file to import.</p>

<pre><code class="language-bash">curl -X POST \
  -F "file=@backup.json" \
  http://localhost:8000/api/v1/backup/import
</code></pre>

<h3>Validate Backup</h3>
<pre><code class="language-bash">POST /api/v1/backup/validate
</code></pre>

<p>Validate a backup file without importing.</p>

<pre><code class="language-bash">curl -X POST \
  -F "file=@backup.json" \
  http://localhost:8000/api/v1/backup/validate
</code></pre>

<h3>Get Database Summary</h3>
<pre><code class="language-bash">GET /api/v1/backup/summary
</code></pre>

<p>Get current database statistics.</p>

<pre><code class="language-bash">curl http://localhost:8000/api/v1/backup/summary
</code></pre>

<h2>‚è∞ Automated Backups with Cron</h2>

<h3>Daily Backup at 2 AM</h3>

<p>Add to your crontab (<code>crontab -e</code>):</p>

<pre><code class="language-bash"># Daily backup at 2 AM
0 2 * * * cd /path/to/dcms/backend &amp;&amp; python backup_cli.py export --output /backups/daily/backup_$(date +\%Y\%m\%d).json

# Weekly backup on Sundays at 3 AM
0 3 * * 0 cd /path/to/dcms/backend &amp;&amp; python backup_cli.py export --output /backups/weekly/backup_$(date +\%Y\%m\%d).json

# Monthly backup on the 1st at 4 AM
0 4 1 * * cd /path/to/dcms/backend &amp;&amp; python backup_cli.py export --output /backups/monthly/backup_$(date +\%Y\%m\%d).json
</code></pre>

<h3>Backup Rotation Script</h3>

<p>Create <code>/backups/rotate_backups.sh</code>:</p>

<pre><code class="language-bash">#!/bin/bash
# Keep last 7 daily backups
find /backups/daily -name "*.json" -mtime +7 -delete

# Keep last 4 weekly backups
find /backups/weekly -name "*.json" -mtime +28 -delete

# Keep last 12 monthly backups
find /backups/monthly -name "*.json" -mtime +365 -delete
</code></pre>

<p>Add to crontab to run daily:</p>
<pre><code class="language-bash">0 5 * * * /backups/rotate_backups.sh
</code></pre>

<h2>üê≥ Docker Backup</h2>

<h3>Export from Docker Container</h3>

<pre><code class="language-bash"># Export database
docker-compose exec backend python backup_cli.py export

# Copy backup file from container to host
docker cp dcms-backend:/app/dcms_backup_*.json ./backups/
</code></pre>

<h3>Import to Docker Container</h3>

<pre><code class="language-bash"># Copy backup file from host to container
docker cp ./backups/backup.json dcms-backend:/app/

# Import database
docker-compose exec backend python backup_cli.py import /app/backup.json
</code></pre>

<h2>üíæ Backup Storage Recommendations</h2>

<h3>Local Storage</h3>
<ul>
<li>Store in <code>/backups</code> directory outside of application folder</li>
<li>Use different physical drives/partitions when possible</li>
<li>Regular filesystem backups (e.g., Time Machine, rsync)</li>
</ul>

<h3>Cloud Storage</h3>
<ul>
<li>AWS S3</li>
<li>Google Cloud Storage</li>
<li>Azure Blob Storage</li>
<li>Dropbox/Google Drive for smaller deployments</li>
</ul>

<h3>Example: Upload to AWS S3</h3>

<pre><code class="language-bash">#!/bin/bash
# backup_to_s3.sh
BACKUP_FILE=$(python backup_cli.py export --output /tmp/backup_$(date +%Y%m%d_%H%M%S).json | grep "File:" | awk '{print $2}')
aws s3 cp $BACKUP_FILE s3://my-bucket/datacenter-backups/
rm $BACKUP_FILE
</code></pre>

<h2>üîí Security Considerations</h2>

<ol>
<li><strong>Encrypt Backups</strong>: Backup files contain sensitive data</li>
</ol>
   <pre><code class="language-bash">   # Encrypt backup
   gpg --symmetric --cipher-algo AES256 backup.json

   # Decrypt backup
   gpg --decrypt backup.json.gpg &gt; backup.json
   </code></pre>

<ol>
<li><strong>Access Control</strong>: Limit who can access backup files</li>
<li><strong>Secure Transfer</strong>: Use HTTPS/SFTP when transferring backups</li>
<li><strong>Audit Logs</strong>: Track who exports/imports backups</li>
</ol>

<h2>üìã Best Practices</h2>

<h3>‚úÖ DO</h3>
<ul>
<li>‚úÖ Create regular automated backups (daily recommended)</li>
<li>‚úÖ Store backups in multiple locations (local + cloud)</li>
<li>‚úÖ Test restore process periodically (monthly)</li>
<li>‚úÖ Label backups with dates and descriptions</li>
<li>‚úÖ Keep 3-2-1 backup strategy (3 copies, 2 media types, 1 offsite)</li>
<li>‚úÖ Encrypt backups containing sensitive data</li>
<li>‚úÖ Document your backup procedures</li>
</ul>

<h3>‚ùå DON'T</h3>
<ul>
<li>‚ùå Store backups only on the same server as the database</li>
<li>‚ùå Use "Clear existing data" on production without testing first</li>
<li>‚ùå Ignore backup errors and warnings</li>
<li>‚ùå Keep backups indefinitely (implement rotation)</li>
<li>‚ùå Share backup files over insecure channels</li>
<li>‚ùå Forget to verify backups can be restored</li>
</ul>

<h2>üîÑ Disaster Recovery Steps</h2>

<h3>Complete Data Loss</h3>

<ol>
<li><strong>Install Application</strong>: Set up DCMS on a new server</li>
<li><strong>Locate Latest Backup</strong>: Find your most recent backup file</li>
<li><strong>Restore Database</strong>:</li>
</ol>
   <pre><code class="language-bash">   python backup_cli.py import backup.json --clear
   </code></pre>
<ol>
<li><strong>Verify Data</strong>: Check that all records are present</li>
<li><strong>Resume Operations</strong>: Application is ready to use</li>
</ol>

<h3>Partial Data Corruption</h3>

<ol>
<li><strong>Export Current State</strong>: Create backup of current (corrupted) state</li>
</ol>
   <pre><code class="language-bash">   python backup_cli.py export --output corrupted_backup.json
   </code></pre>
<ol>
<li><strong>Import Clean Backup</strong>: Import a known-good backup (without --clear to add data)</li>
</ol>
   <pre><code class="language-bash">   python backup_cli.py import good_backup.json
   </code></pre>
<ol>
<li><strong>Manual Cleanup</strong>: Remove duplicate or corrupted records via Web UI</li>
</ol>

<h3>Testing Recovery</h3>

<p>Regularly test your backups:</p>

<pre><code class="language-bash"># 1. Export current database
python backup_cli.py export --output prod_backup.json

# 2. Create test database (modify database connection in .env)
# 3. Import to test database
python backup_cli.py import prod_backup.json --clear

# 4. Verify all data is present
python backup_cli.py summary

# 5. Test application functionality
</code></pre>

<h2>üìä Backup File Structure</h2>

<pre><code class="language-json">{
  "metadata": {
    "backup_date": "2025-11-16T12:00:00Z",
    "version": "1.0",
    "description": "Full database backup",
    "exported_by": "CLI|API",
    "export_timestamp": "2025-11-16T12:00:00Z"
  },
  "tables": {
    "asset_types": {
      "count": 15,
      "columns": ["id", "name", "display_name", ...],
      "data": [...]
    },
    "datacenters": {
      "count": 3,
      "columns": ["id", "name", "code", ...],
      "data": [...]
    },
    ...
  }
}
</code></pre>

<h2>üÜò Troubleshooting</h2>

<h3>Import Fails with Foreign Key Errors</h3>
<p><strong>Solution</strong>: Tables are imported in correct order. Ensure backup file is valid:</p>
<pre><code class="language-bash">python backup_cli.py validate backup.json
</code></pre>

<h3>Large Backup File Size</h3>
<p><strong>Solution</strong>:</p>
<ul>
<li>Compress backups: <code>gzip backup.json</code></li>
<li>Clean old lifecycle events and maintenance records</li>
<li>Implement data archiving strategy</li>
</ul>

<h3>Slow Export/Import</h3>
<p><strong>Solution</strong>:</p>
<ul>
<li>Normal for large databases (10k+ records)</li>
<li>Run during off-peak hours</li>
<li>Consider database-level backup for very large datasets</li>
</ul>

<h3>Permission Errors</h3>
<p><strong>Solution</strong>:</p>
<pre><code class="language-bash"># Ensure proper permissions
chmod +x backend/backup_cli.py
chown -R user:user /backups
</code></pre>

<h2>üìû Support</h2>

<p>For backup-related issues:</p>
<ol>
<li>Check application logs in <code>backend/logs/</code></li>
<li>Review backup validation errors</li>
<li>Consult this guide</li>
<li>Contact system administrator</li>
</ol>

<hr>

<p><strong>Remember</strong>: The best backup is the one you can successfully restore! Test your backups regularly.</p>

            </article>
        </main>
    </div>
    <script src="app.js"></script>
</body>
</html>